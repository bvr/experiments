
use 5.16.3;
use Test::More;
use Data::Dump;
use Function::Parameters;

my $example = <<END;
     |
     |  +--+
     A  |  C
 F---|----E|--+
     |  |  |  D
     +B-+  +--+
END

is walk_network($example)->{word},  'ABCDEF', 'Example run';
is walk_network($example)->{steps}, 38,       'Example run - part 2';

my $input = do { local $/; <DATA> };
is walk_network($input)->{word},  'UICRNSDOK', 'Part 1';
is walk_network($input)->{steps}, 16064,       'Part 2';

done_testing;

fun build_indexer($input) {
    my $area = [ split /\n/, $input ];
    return (
        index($area->[0],'|'), 0,
        fun($x, $y) { return substr($area->[$y], $x, 1) || ' '; }
    );
}

fun walk_network($network) {
    my ($x, $y, $index) = build_indexer($network);
    my ($dx, $dy) = (0, 1);

    my @word = ();
    my $steps = 0;
    while(1) {
        $x += $dx; $y += $dy;
        $steps++;
        my $ch = $index->($x, $y);
        # warn "$x, $y [$dx, $dy]: $ch\n";

        last if $ch eq ' ';
        push @word, $ch if $ch =~ /[A-Z]/;
        if($ch eq '+') {
            my $l = $index->($x + $dy, $y + $dx);
            my $r = $index->($x - $dy, $y - $dx);
            if(   $l ne ' ') { ($dx, $dy) = ( $dy,  $dx); }
            elsif($r ne ' ') { ($dx, $dy) = (-$dy, -$dx); }
            else { die 'no way forward' }
        }
    }

    return { word => join('', @word), steps => $steps };
}

=head1 ASSIGNMENT

http://adventofcode.com/2017/day/19

=head2 --- Day 19: A Series of Tubes ---

Somehow, a network packet got lost and ended up here. It's trying to follow a
routing diagram (your puzzle input), but it's confused about where to go.

Its starting point is just off the top of the diagram. Lines (drawn with |, -,
and +) show the path it needs to take, starting by going down onto the only
line connected to the top of the diagram. It needs to follow this path until it
reaches the end (located somewhere within the diagram) and stop there.

Sometimes, the lines cross over each other; in these cases, it needs to
continue going the same direction, and only turn left or right when there's no
other option. In addition, someone has left letters on the line; these also
don't change its direction, but it can use them to keep track of where it's
been. For example:

     |
     |  +--+
     A  |  C
 F---|----E|--+
     |  |  |  D
     +B-+  +--+

Given this diagram, the packet needs to take the following path:

=over

=item * Starting at the only line touching the top of the diagram, it must go down, pass through A, and continue onward to the first +.

=item * Travel right, up, and right, passing through B in the process.

=item * Continue down (collecting C), right, and up (collecting D).

=item * Finally, go all the way left through E and stopping at F.

=back

Following the path to the end, the letters it sees on its path are C<ABCDEF>.

The little packet looks up at you, hoping you can help it find the way. What
letters will it see (in the order it would see them) if it follows the
path? (The routing diagram is very wide; make sure you view it without line
wrapping.)

Your puzzle answer was UICRNSDOK.

=head2 --- Part Two ---

The packet is curious how many steps it needs to go.

For example, using the same routing diagram from the example above...

     |
     |  +--+
     A  |  C
 F---|--|-E---+
     |  |  |  D
     +B-+  +--+

...the packet would go:

    6 steps down (including the first line at the top of the diagram).
    3 steps right.
    4 steps up.
    3 steps right.
    4 steps down.
    3 steps right.
    2 steps up.
    13 steps left (including the F it stops on).

This would result in a total of 38 steps.

How many steps does the packet need to go?

Your puzzle answer was 16064.

Both parts of this puzzle are complete! They provide two gold stars: **

=cut

__DATA__
                                                                                                                                                                   |
   +-------+                   +---------------------+                     +-----------+                         +---------------------------------------+         |                                 +-+
   |       |                   |                     |                     |           |                         |                                       |         |                                 | |
   |       |   +---------------|---------------------|-----------------------------------------------------------------------------+           +---------------------+                               | |
   |       |   |               |                     |                     |           |                         |                 |           |         |         | |                               | |
   |   +-----------------+ +---+     +-----------+   |                     |           |                         |   +-------------+           |         |         | |                               | |
   |   |   |   |         | |         |           |   |                     |           |                         |   |                         |         |         | |                               | |
   |   |   | +-|---------|-----------|---------+ +-----------+             |           +-----------------------------|-------+                 |         |         | |                               | |
   |   |   | | |         | |         |         |     |       |             |                                     |   |       |                 |         |         | |                               | |
   |   |   | | |         +---+       |     +-------------------------------|-------------------------------------|-----------------------------+         |         | |                 +-------------+ |
   |   |   | | |           | |       |     |   |     |       |             |                                     |   |       |                           |         | |                 |               |
   |   |   | | |           | |     +-|-----|---|---------------------------|-----------+                         |   |       |                           |         | |                 |               |
   |   |   | | |           | |     | |     |   |     |       |             |           |                         |   |       |                           |         | |                 |               |
   |   |   | | |           | |     | |     |   +-----|-----+ |             |           |                 +-------|---|-------+                           |         | |                 |               |
   |   |   | | |           | |     | |     |         |     | |             |           |                 |       |   |                                   |         | |                 |               |
   |   |   | | |           | |     | |     |         |     +-|-------------------------+       +---------|-------|---------------------------------------|---------|-------------------|-+     +-+     |
   |   |   | | |           | |     | |     |         |       |             |                   |         |       |   |                                   |         | |                 | |     | |     |
   |   |   | +-|-------------|-----|-----------------------+ |             |                   |         |       |   |                                   |         | |                 | |     +-|-+   |
   |   |   |   |           | |     | |     |         |     | |             |                   |         |       |   |                                   |         | |                 | |       | |   |
   |   |   |   |           | |     | |     |   +-----|-------|-------------|-------------------|---------+       |   |                     +-------------|---------|I|-------------------------+ | |   |
   |   |   |   |           | |     | |     |   |     |     | |             |                   |                 |   |                     |             |         | |                 | |     | | |   |
   |   |   |   |           | |     | |     |   |     |     | |             |                   | +-----------+   |   |               +-----|------C------------------------------------+ |     | | |   |
   |   |   |   |           | |     | |     |   |     |     | |             |                   | |           |   |   |               |     |             |         | |                   |     | | |   |
   |   |   |   |   +-------|---------|-----|---------------|-|-------------|---------+         | |           |   +---|-------+       |     |   +---------|-----+   | |               +-+ |     | | |   |
   |   |   |   |   |       | |     | |     |   |     |     | |             |         |         | |           |       |       |       |     |   |         |     |   | |               | | |     | | |   |
   |   |   |   |   |       +-------|-|-----|---|-----|---------------------|---------|---------|-------------|---+   |       |       |     |   |         |     |   | |               | | |   +---+ |   |
   |   |   |   |   |         |     | |     |   |     |     | |             |         |         | |           |   |   |       |       |     |   |         |     |   | |               | | |   | |   |   |
   |   |   |   +-------------------|-|---------------------+ |         +-----------------------|-----------------|---|---------------------|-----------------------------------------|-|-------|-+ |   |
   |   |   |       |         |     | |     |   |     |       |         |   |         |         | |           |   |   |       |       |     |   |         |     |   | |               | | |   | | | |   |
   |   |   |       |         |     | |     |   |     |       |         |   |         |         | |           |   |   +---------------|---------|N--------------|-----+               | | |   | | | |   |
   |   |   |       |         |     | |     |   |     |       |         |   |         |         | |           |   |           |       |     |   |         |     |   |                 | | |   | | | |   |
   |   |   |   +-----------+ |     | |     +---|-----|-----------------|---+         |         | |         +-|---|-------------------|---------|---------|-----|---|-----------------|-|-|---+ | | |   |
   |   |   |   |   |       | |     | |         |     |       |         |             |         | |         | |   |           |       |     |   |         |     |   |                 | | |     | | |   |
   |   |   |   |   |       | |     | |         |     |       |         |             |         | |         | |   |           |       |     |   |         |     |   |                 | | |     | | |   |
   |   |   |   |   |       | |     | |         |     |       |         |             |         | |         | |   |           |       |     |   |         |     |   |                 | | |     | | |   |
   |   |   |   |   +-------|-|---+ | |         |     |       |         |             |         | |         | |   |           |       |     |   |         |     |   |                 | | |     | | |   |
   |   |   |   |           | |   | | |         |     |       |         |             |         | |         | |   |           |       |     |   |         |     |   |                 | | |     | | |   |
   |   |   |   |           | +-+ | | |         |     |       |         |   +-------------------|---------+ | |   |           |       |     |   |         |     |   |                 | | |     | | |   |
   |   |   |   |           |   | | | |         |     |       |         |   |         |         | |       | | |   |           |       |     |   |         |     |   |                 | | |     | | |   |
   +---|-------|---------------|---|-|-----------+   |       |         |   |         |         | |       | | |   |           |       |     |   |         |     |   |                 | | |     | | |   |
       |   |   |           |   | | | |         | |   |       |         |   |         |         | |       | | |   |           |       |     |   |         |     |   |                 | | |     | | |   |
       |   |   |           |   +---|-+         | |   |       |         |   |   +-+   |         | |       +-+ |   +-------------------------|-----------------------|-----------------|---+     | | |   |
       |   |   |           |     | |           | |   |       |         |   |   | |   |         | |           |               |       |     |   |         |     |   |                 | |       | | |   |
       |   |   |           |     | |           | |   |       |         |   |   | |   | +-------|-------------|---------------|-------------|-------------------|-------------------+ | |       | | |   |
       |   |   |           |     | |           | |   |       |         |   |   | |   | |       | |           |               |       |     |   |         |     |   |               | | |       | | |   |
       |   |   |   +-------|-----|-------+     | |   |       |         |   |   | |   | |       | |           |               |       |     |   |         |     |   |               | | |       | | +-+ |
       |   |   |   |       |     | |     |     | |   |       |         |   |   | |   | |       | |           |               |       |     |   |         |     |   |               | | |       | |   | |
       |   |   |   |       |     | |     |     | |   |       +---------|---------------|---------|-----------|-----------------------------|-------------|---------|---------------|-|-----------|---+ |
       |   |   |   |       |     | |     |     | |   |                 |   |   | |   | |       | |           |               |       |     |   |         |     |   |               | | |       | |     |
       |   |   |   |       +-----|-|-----|-----|-----|-------+         |   |   | |   | |       | |       +-----------------------+   |     |   |         |     |   |               | | |     +-------+ |
       |   |   |   |             | |     |     | |   |       |         |   |   | |   | |       | |       |   |               |   |   |     |   |         |     |   |               | | |     | | |   | |
       |   |   |   |             | |     |     | |   |       |         |   |   | |   | | +-----------------------------------|---|-------------|---------|-----|-------------------------------|-+ +-+ |
       |   |   |   |             | |     |     | |   |       |         |   |   | |   | | |     | |       |   |               O   |   |     |   |         |     |   |               | | |     | |   |   |
       |   |   |   |     +-------|-------|-----------|-------|-------------|-----|---|-|-------|---------|---|-------------------|-----------------------------|-----------------+ | | |     | |   |   |
       |   |   |   |     |       | |     |     | |   |       |         |   |   | |   | | |     | |       |   |               |   |   |     |   |         |     |   |             | | | |     | |   |   |
       |   |   |   |     |       | |     |     | |   |       |         |   |   | |   | | |     | |       |   |       +-+     |   |   |     |   |         |     |   |             | | | |     | |   |   |
       |   |   |   |     |       | |     |     | |   |       |         |   |   | |   | | |     | |       |   |       | |     |   |   |     |   |         |     |   |             | | | |     | |   |   |
       |   |   |   |     |   +---|-|-----|-----|-|--R|-------|-------------|---|---------------|-------------|-------|-|---------|---------|---|---------|---------|-----------------|-|-----------|-+ |
       |   |   |   |     |   |   | |     |     | |   |       |         |   |   | |   | | |     | |       |   |       | |     |   |   |     |   |         |     |   |             | | | |     | |   | | |
       |   |   |   |   +-----+   | |     |     | |   |       |         |   |   | |   | | |     | |       +---------------------------|-------------------|-----------------------+ | | |     | |   | | |
       |   |   |   |   | |       | |     |     | |   |       |         |   |   | |   | | |     | |           |       | |     |   |   |     |   |         |     |   |               | | |     | |   | | |
       |   |   |   |   | |       | |     |     | |   |     +-----------|-------|-|-------|-------|-----------|-------|-------|-------------|---------------------------------+     | +-------+ |   | | |
       |   |   |   |   | |       | |     |     | |   |     | |         |   |   | |   | | |     | |           |       | |     |   |   |     |   |         |     |   |         |     |   |       |   | | |
       |   |   |   |   | |       | +-----|-------|---------|-----------|---|-----|-------------|-|---------------------------------+ |     |   |         |     |   |         |   +-----|-------|---+ | |
       |   |   |   |   | |       |       |     | |   |     | |         |   |   | |   | | |     | |           |       | |     |   | | |     |   |         |     |   |         |   | |   |       |     | |
       |   |   | +---------------|-------|S------|---|-----+ |         |   |   | |   | | |     | |   +-------|---------|---------|---------|---|-------+ +---------|-------------+ |   |       |     | |
       |   |   | | |   | |       |       |     | |   |       |         |   |   | |   | | |     | |   |       |       | |     |   | | |     |   |       |       |   |         |     |   |       |     | |
       |   |   | | |   | |   +-----------------|-----|-------|-------------|-----|---|---|-----|-|-----------|-------|-|-----|---|-|-+     |   |       |       |   |         |     |   |       |     | |
       |   |   | | |   | |   |   |       |     | |   |       |         |   |   | |   | | |     | |   |       |       | |     |   | |       |   |       |       |   |         |     |   |       |     | |
       |   |   | | +-------------|-------------|-|---|-------|-------------|---------|-------------------------------|-------|-------------|-------+   |       |   |         |     |   |       |     | |
       |   |   | |     | |   |   |       |     | |   |       |         |   |   | |   | | |     | |   |       |       | |     |   | |       |   |   |   |       |   |         |     |   |       |     | |
       | +-|---|-|-----|-|---------------|-------|-----------|-------------------|-------------|-|---------------------|-----|---|-|-------|-------|---|---------+ |         |     |   |       |     | |
       | | |   | |     | |   |   |       |     | |   |       |         |   |   | |   | | |     | |   |       |       | |     |   | |       |   |   |   |       | | |         |     |   |       |     | |
       | | |   | |     | |   | +---------|-----|-|-------+   |         |   |   | |   | | |     | |   |       |       | |     |   +-------------|-----------------|-----+     |     |   |       |     | |
       | | |   | |     | |   | | |       |     | |   |   |   |         |   |   | |   | | |     | |   |       |       | |     |     |       |   |   |   |       | | |   |     |     |   |       |     | |
       | | |   | |     | |   | | |       |     | |   |   |   |       +-|---|---|---------|-------|-------------------------------------------------|---|-----+ | | |   |     |     |   |       |     | |
       | | |   | |     | |   | | |       |     | |   |   |   |       | |   |   | |   | | |     | |   |       |       | |     |     |       |   |   |   |     | | | |   |     |     |   |       |     | |
       | | |   | |     | |   | | |       |     | |   |   |   |       | |   |   | |   | | |     | |   |       |     +-|-|-----------|-------------------+     | | | |   |     |     |   |       |     | |
       | | |   | |     | |   | | |       |     | |   |   |   |       | |   |   | |   | | |     | |   |       |     | | |     |     |       |   |   |         | | | |   |     |     |   |       |     | |
       | | |   | |     | |   | | +---+   |     | |   |   |   |       | +-+ |   | |   | +-+ +---|-|---|-------|-----|-|-------------|-----------|---|---------|-|-------|-----|---------|-------------|-+
       | | |   | |     | |   | |     |   |     | |   |   |   |       |   | |   | |   |     |   | |   |       |     | | |     |     |       |   |   |         | | | |   |     |     |   |       |     |
       | | |   | |     | |   | |     |   |     | |   |   |   |       |   | |   | |   |     |   | |   |       |     | | |     |     |       |   |   |         | | | |   |     | +-------|-------|-----+
       | | |   | |     | |   | |     |   |     | |   |   |   |       |   | |   | |   |     |   | |   |       |     | | |     |     |       |   |   |         | | | |   |     | |   |   |       |
   +---|-|-|---|-------|-|-----|---------|-----|-----|---|---+       |   | |   | |   |     | +-|-|---|-------|-----|---|-----------|---+   |   |   |         | | | |   |     | |   |   |       |
   |   | | |   | |     | |   | |     |   |     | |   |   |           |   | |   | |   |     | | | |   |       |     | | |     |     |   |   |   |   |         | | | |   |     | |   |   |       |
   |   | +-------|-----|-|-----|-----|---|-----------|-------------------|-|---|-----|-----|-+ | |   |       |     | | |     |     +-----------|---|-------+ | | | |   |     | |   |   |       |
   |   |   |   | |     | |   | |     |   |     | |   |   |           |   | |   | |   |     |   | |   |       |     | | |     |         |   |   |   |       | | | | |   |     | |   |   |       |
   | +-+   |   | |     | |   | |     |   |     | |   |   |           |   | |   | |   |     |   | |   |       |     | | |     |         |   |   |   |       | | | | |   |     | |   |   |       |
   | |     |   | |     | |   | |     |   |     | |   |   |           |   | |   | |   |     |   | |   |       |     | | |     |         |   |   |   |       | | | | |   |     | |   |   |       |
   | |   +-----|-------|-|---|-|-+   |   +-----|---------------------|-----|---|-----|-----|---|-|---|-------------------------+       |   |   |   +-------|---|-|-|---|-----+ |   |   |       |
   | |   | |   | |     | |   | | |   |         | |   |   |           |   | |   | |   |     |   | |   |       |     | | |     | |       |   |   |           | | | | |   |       |   |   |       |
   | |   | |   | |     | |   | | +-------------------|---------------------------|---------+ +---|-----------+     +-|-+     | +-------|-+ |   |           | | | | |   |       |   |   |       |
   | |   | |   | |     | |   | |     |         | |   |   |           |   | |   | |   |       | | |   |               |       |         | | |   |           | | | | |   |       |   |   |       |
   | |   | |   | |     | |   | |     |         | |   |   +---------------|---------------------------------------------+     |         | | |   |           | | | | |   |       |   |   |       |
   | |   | |   | |     | |   | |     |         | |   |               |   | |   | |   |       | | |   |               | |     |         | | |   |           | | | | |   |       |   |   |       |
   | |   | |   | |     | |   | |     |         | |   |               |   | |   | |   |       | | |   |               | |     |         | | |   |           | | | | |   |       |   |   |       |
   | |   | |   | |     | |   | |     |         | |   |               |   | |   | |   |       | | |   |               | |     |         | | |   |           | | | | |   |       |   |   |       |
   | |   | |   | |     | |   | |     |         | |   |               |   | |   | |   |   +---|---|---|-----------------|-----|-----------|-|---------------|-|---+ |   |       |   |   |     +-|-------+
   | |   | |   | |     | |   | |     |         | |   |               |   | |   | |   |   |   | | |   |               | |     |         | | |   |           | | |   |   |       |   |   |     | |       |
 +---|-----|---|-|-----|-|-----|-----|--U--------|---|-----------------------+ | |   |   |   | | |   |               | |     |         | | |   |           | | |   |   |       |   |   |     | |       |
 | | |   | |   | |     | |   | |     |         | |   |               |   | | | | |   |   |   | | |   |               | |     |         | | |   |           | | |   |   |       |   |   |     | |       |
 | | |   | |   | |     | |   | |     |         | |   |               |   | | | +-----------+ | | |   |               | |     |         | | |   |           | | |   |   +-----+ |   +---|-+   | |       |
 | | |   | |   | |     | |   | |     |         | |   |               |   | | |   |   |   | | | | |   |               | |     |         | | |   |           | | |   |         | |       | |   | |       |
 | | |   | |   | |     | |   | |     |         | |   |         +-----|---|-|---------|---|-|-|-+ |   |               | |     |         | | |   |           | | |   |       +---+       | |   | |       |
 | | |   | |   | |     | |   | |     |         | |   |         |     |   | | |   |   |   | | |   |   |               | |     |         | | |   |           | | |   |       | |         | |   | |       |
 | | |   | |   | |     | |   | |     |         | |   |         |     |   | | |   |   |   | | |   | +-----------------+ |     |         | | |   |           | | |   |       | |         | |   | |       |
 | | |   | |   | |     | |   | |     |         | |   |         |     |   | | |   |   |   | | |   | | |                 |     |         | | |   |           | | |   |       | |         | |   | |       |
 | | |   | |   | | +---|-|D--|-------+ +---------|---|---------|-----|-----|---------|---|-|---+ | | |                 |     |         | +-|---------------|---------------|-|---------|-|---|-------+ |
 | | |   | |   | | |   | |   | |       |       | |   |         |     |   | | |   |   |   | | | | | | |                 |     |         |   |   |           | | |   |       | |         | |   | |     | |
 | | |   | |   | | |   | |   | |       |       | |   |         |     |   | | |   |   | +---|---|-|-|-------------------|-----------------------+           | | |   |       | |         | |   | |     | |
 | | |   | |   | | |   | |   | |       |       | |   |         |     |   | | |   |   | | | | | | | | |                 |     |         |   |               | | |   |       | |         | |   | |     | |
 | | |   | |   | | +---|-------|---+   +-------|-|---|---------|-----+   | | |   |   | | | | | | | | |                 |     |         |   |               | | |   |       | |         | |   | |     | |
 | | |   | |   | |     | |   | |   |           | |   |         |         | | |   |   | | | | | | | | |                 |     |         |   |               | | |   |       | |         | |   | |     | |
 | | +---|-----|---+   | |   | |   |           +---------------------------------------|-|-|-|-|-|---|-----------------|-----|-------------|---------------------------+   | |   +-----|-----|-------+ |
 | |     | |   | | |   | |   | |   |             |   |         |         | | |   |   | | | | | | | | |                 |     |         |   |               | | |   |   |   | |   |     | |   | |       |
 | |     | | +---|-+   | |   | |   |             |   |         |         | | |   |   | | | | | | | | |                 |     |         |   |               | | |   |   |   | |   |     | |   | |       |
 | |     | | | | |     | |   | |   |             |   |         |         | | |   |   | | | | | | | | |                 |     |         |   |               | | |   |   |   | |   |     | |   | |       |
 | |     | | | | |     | |   | |   |             +-------------|---------|---|-------|---|-|-|---|---|-----------------|-----|---------|-----------------------|-------|---|-----|-------|---|-+       |
 | |     | | | | |     | |   | |   |                 |         |         | | |   |   | | | | | | | | |                 |     |         |   |               | | |   |   |   | |   |     | |   |         |
 | |     | | | | | +---|-|---------|-----------------|---------|---------|-|-----+   | | | | | | | | |                 |     |         |   |               | | |   |   |   | |   +-----------|-----+   |
 | |     | | | | | |   | |   | |   |                 |         |         | | |       | | | | | | | | |                 |     |         |   |               | | |   |   |   | |         | |   |     |   |
 | |     | | | | | |   | |   | |   |                 |         |         | | |       +-|-|---|-|-----+                 |     |         |   |   +-----------|-------|---|---|-+ +-------|-----|-----|-+ |
 | |     | | | | | |   | |   | |   |                 |         |         | | |         | | | | | | |                   |     |         |   |   |           | | |   |   |   |   |       | |   |     | | |
 | |     | | | | | |   | |   | |   |                 |   +---------------|---|---------|-|-----|-|-|-------------------|---------------|---|---------------|-|-|---|-------|-----+     | |   |     | | |
 | |     | | | | | |   | |   | |   |                 |   |     |         | | |         | | | | | | |                   |     |         |   |   |           | | |   |   |   |   | |     | |   |     | | |
 | |     | | | | | |   | |   | |   |                 |   |     |         | | |         | | | | +-|-|-------------------|-----|---------------+ +-----------|-|---------|-------|---------|---|-----|-+ |
 | |     | | | | | |   | |   | |   |                 |   |     |         | | |         | | | |   | |                   |     |         |   | |             | | |   |   |   |   | |     | |   |     |   |
 | |     | | | | | |   | |   | |   |                 |   |     |         | | |         | | | |   | |       +-----------+     |         |   | |             | | |   |   |   |   | |     | |   |     |   |
 | |     | | | | | |   | |   | |   |                 |   |     |         | | |         | | | |   | |       |                 |         |   | |             | | |   |   |   |   | |     | |   |     |   |
 | |     | | | +---------|---|-|---|---------+       |   |     |         | | |   +-------|-|---------------|---------------------------|---|-----------------|-----+   |   |   | |     | |   |     |   |
 | |     | | |   | |   | |   | |   |         |       |   |     |         | | |   |     | | | |   | |       |                 |         |   | |             | | |       |   |   | |     | |   |     |   |
 | +-------+ |   | |   | |   | |   |         +---------------------------|-------------|---|---------------|---------------------------------------------------|---------------|-|-----------------|-+ |
 |       |   |   | |   | |   | |   |                 |   |     |         | | |   |     | | | |   | |       |                 |         |   | |             | | |       |   |   | |     | |   |     | | |
 |       |   |   | |   | |   | |   |                 |   |     |         | | |   +-----|-|---|-----------------------------------------|-------------------|-|-------------------+     | |   |     | | |
 |       |   |   | |   | |   | |   |                 |   |     |         | | |         | | | |   | |       |                 |         |   | |             | | |       |   |   |       | |   |     | | |
 |       |   |   | |   | |   | |   |                 |   |     |         | | |         | | | |   | |       |                 |         |   +-|---------------|-------------|---|-------|-|---|-----|---+
 |       |   |   | |   | |   | |   |                 |   |     |         | | |         | | | |   | |       |                 |         |     |             | | |       |   |   |       | |   |     | |
 |       | +-------|---|-|---------------------------|---|---------------|---|---------|-----------|-------------------------|---------|-----|-+           | | |       |   |   |       | |   |     | |
 |       | | |   | |   | |   | |   |                 |   |     |         | | |         | | | |   | |       |                 |         |     | |           | | |       |   |   |       | |   |     | |
 |       | | +---|-----------|-------------+         |   |     |         | | |         | | | |   | |       |                 |         |     | +-------------|-------------|---------+ | |   |     | |
 |       | |     | |   | |   | |   |       |         |   |     |         | | |         | | | |   | |       |                 |         |     |             | | |       |   |   |     | | |   |     | |
 |       | |     | |   | |   | |   |       |         |   |     |         | | |         | | | |   | |       |                 |         |     |       +-----|---+       |   |   |     | | |   |     | |
 |       | |     | |   | |   | |   |       |         |   |     |         | | |         | | | |   | |       |                 |         |     |       |     | |         |   |   |     | | |   |     | |
 |       | |     | |   +-|-----|---|---------------------|---------------|-|-|---------|---|-|---|---------------------------|-----------------------|-----------------|-------------|-|-+   |     | |
 |       | |     | |     |   | |   |       |         |   |     |         | | |         | | | |   | |       |                 |         |     |       |     | |         |   |   |     | |     |     | |
 |       | |     | |     |   | |   |       |         |   |     |         | | |         | | | |   | +-----------------------------------|-+   |       |     | |         |   |   |     | |     |     | |
 |       | |     | |     |   | |   |       |         |   |     |         | | |         | | | |   |         |                 |         | |   |       |     | |         |   |   |     | |     |     | |
 |       | |     | |     |   | |   |       |         |   |     |         | | |         | | | |   |         |                 |         | |   |       |     | |         |   |   |     | |     |     | |
 |       | |     | |     |   | |   |       |         |   |     |         | | |         | | | |   |         |                 |         | |   |       |     | |         |   |   |     | |     |     | |
 |       | |     | |     |   | | +---------+         |   |     |         | | |         | | | |   |         |                 |         | |   |       |     | |         |   |   |     | |     |     | |
 |       | |     | |     |   | | | |                 |   |     |         | | |         | | | |   |         |                 |         | |   |       |     | |         |   |   |     | |     |     | |
 |       | |     | |     |   | | | |       +---------------------------------|---------------+   |         | +---------------|-----------------------|-----|-|---------|---------------|-----------|-|-+
 |       | |     | |     |   | | | |       |         |   |     |         | | |         | | |     |         | |               |         | |   |       |     | |         |   |   |     | |     |     | | |
 | +-------------|-|-----------------------+         |   +-----|---------|-----------------|-----|-+       | |               |         | |   |       |     | |         |   |   |     | |     |     | | |
 | |     | |     | |     |   | | | |                 |         |         | | |         | | |     | |       | |               |         | |   |       |     | |         |   |   |     | |     |     | | |
 | |     | |     | |     |   | | | |                 |         |         | | |         | | |     | |       | |               |         | |   |       |     | |         |   |   |     | |     |     | | |
 | |     | |     | |     |   | | | |                 |         |         | | |         | | |     | |       | |               |         | |   |       |     | |         |   |   |     | |     |     | | |
 | |     | |     | |     |   | | | |                 |         |         | | |         | | | +---|-|-------|-|-------------------------|-----|-------------|-----------|---|-----+   | |     |     | | |
 | |     | |     | |     |   | | | |                 |         |         | | |         | | | |   | |       | |               |         | |   |       |     | |         |   |   | |   | |     |     | | |
 | |     | |     | |     |   | | | |                 |   +-----------------|-----------|-------------------|-|---------------|---------|-|-----------------|-|---------|---|-----+   | |     |     | | |
 | |     | |     | |     |   | | | |                 |   |     |         | | |         | | | |   | |       | |               |         | |   |       |     | |         |   |   |     | |     |     | | |
 | |     | |     | |     |   | | | |                 |   +-----|-----------|-|---------|---|-----|-+       | |       +-------|---------|---------------------------------------|-----|---+   |     | | |
 | |     | |     | |     |   | | | |                 |         |         | | |         | | | |   |         | |       |       |         | |   |       |     | |         |   |   |     | | |   |     | | |
 | +-----|-------+ |     +---|---+ |                 |         |         | | |         | | | |   |         | |       |     +-|---------------|-------|-------------------------|-----|-|---+ |     | | |
 |       | |       |         | |   |                 |         |         | | |         | | | |   |         | |       |     | |         | |   |       |     | |         |   |   |     | | | | |     | | |
 |   +-----|-----------------|-|---|-----------------|---------|---------|-------------|---|---------------|-|-------|-----|-----------|-----|-------------|-----------|---|-----+   | | +-----+   | +-+
 |   |   | |       |         | |   |                 |         |         | | |         | | | |   |         | |       |     | |         | |   |       |     | |         |   |   | |   | |   | | |   |
 |   |   | +-------|-+     +-|-+   |                 |         |         | | |         | | | |   |         | |       |     | |         | |   |       |     | |         |   | +-+ |   | |   | | |   |
 |   |   |         | |     | |     |                 |         |         | | |         | | | |   |         | |       |     | |         | |   |       |     | |         |   | |   |   | |   | | |   |
 |   |   |         +-|-----------------------------------------|-------------|-+       +-|-------------+   | |       |     | |         | |   +-------------|-----------|-----|---|---|-|---|-|-|---|---+
 |   |   |           |     | |     |                 |         |         | | | |         | | |   |     |   | |       |     | |         | |           |     | |         |   | |   |   | |   | | |   |   |
 | +-------------------------|-----------------------|---------|-----------|-|-|-----------|-+   |     |   | | +-----------|-|-----------------------------------------|---|-|---|---|-|---|-|-|---+   |
 | | |   |           |     | |     |                 |         |         | | | |         | |     |     |   | | |     |     | |         | |           |     | |         |   | |   |   | |   | | |       |
 | | |   | +---------|-----|-|---+ |                 |         |         | | +-----------|-------------|-------|-------------|---------|-|---------+ |     | |         |   | |   |   | |   | | |       |
 | | |   | |         |     | |   | |                 |         |         | |   |         | |     |     |   | | |     |     | |         | |         | |     | |         |   | |   |   | |   | | |       |
 | | +---------------------|-----|-------------------|---------|-----------|---------------|-----|---------|---------------+ |         | |         +-----+ | |         |   | |   |   | +-----|-----+   |
 | |     | |         |     | |   | |                 |         |         | |   |         | |     |     |   | | |     |       |         | |           |   | | |         |   | |   |   |     | | |   |   |
 +-+     | +---------------+ +---------------------------------------------|---+         | |     |     |   | | |     |       |         | |   +-------|---------------------------+ +-------+ | +-+ |   |
         |           |           | |                 |         |         | |             | |     |     |   | | |     |       |         | |   |       |   | | |         |   | |     | |       |   | |   |
   +-----+ +---------------------------------------------------|-----------+             | |     +-------------------|-------|---------+ |   |       |   | | |         |   | +-------|---+   |   | |   |
   |       |         |           | |                 |         |         |               | |           |   | | |     |       |           |   |       |   | | |         |   |       | |   |   |   | |   |
   |       +-----+   +-----------|-|-----------------|-------------------+               | |       +---|-------------+     +-----------------|---------------|-------------------+ | |   +-+ |   +-+   |
   |             |               | |                 |         |                         | |       |   |   | | |           | |           |   |       |   | | |         |   |     | | |     | |         |
 +-+ +-----------|---------------|-------------------+         |                         | |   +---|---|-------------------|-|-----------|---|-----------|-+ |         |   |     | | |     | |       +-+
 |   |           |               | |                           |                         | |   |   |   |   | | |           | |           |   |       |   |   |         |   |     | | |     | |       |
 | +-------------|-----------------|-----------------------------------------------------|-|---|---|-------|-|-------------|---------------------------------|---------|---|---------------|-+       |
 | | |           |               | |                           |                         | |   |   |   |   | | |           | |           |   |       |   |   |         |   |     | | |     |         |
 | | +-----------|-----------------|---------------------------|-----------------------------------|---|---|-|-|-------------------+     |   |       |   |   |         |   |   +-+ | |     |         |
 | |             |               | |                           |                         | |   |   |   |   | | |           | |     |     |   |       |   |   |         |   |   |   | |     |         |
 | |             |               | |                           |                         | +-------|---|---|-+ |           +-+     |     | +---------|---|---+         |   +-------+ |     |         |
 | |             |               | |                           |                         |     |   |   |   |   |                   |     | | |       |   |             |       |     |     |         |
 | |             |               +-------------------------------------------------------------|---|-------|-----------------------|-----+ +-+       |   |             |       +-----------+         |
 | |             |                 |                           |                         |     |   |   |   |   |                   |                 |   |             |             |               |
 +-|-------------------------------------+                     |                         +-----+   +---+   +---+                   +---------------+ +-+ +-------------|---------------------------+ |
   |             |                 |     |                     |                                                                                   |   |               |             |             | |
   |             |   +-------------+     +---+                 +---------------------------------------------------------------------------------------|---------------|-------------|-------------+ |
   |             |   |                       |                                                                                                     |   |               |             |               |
   +-----------------------------------------------------------------------------------------------------------------------------------------------+ K-+               +-------------+               |
                 |   |                       |                                                                                                                                                       |
                 +---+                       +-------------------------------------------------------------------------------------------------------------------------------------------------------+

